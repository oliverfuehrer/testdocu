= Project Architecture
:toc:
:icons: font
:sectanchors:
:sectnums:
:mermaid-format: svg
// Uncomment to use a remote Kroki server instead of local rendering
// :kroki-server-url: https://kroki.io

// For local builds with Asciidoctor Diagram, ensure the extension is enabled.
ifdef::backend-html5[]
:imagesoutdir: ./images
endif::[]

== About
This document demonstrates Mermaid C4 and sequence diagrams rendered locally via Asciidoctor Diagram or Kroki, and on GitHub via mermaid code blocks. [web:1][web:17][web:16][web:5]

See also xref:docu2.adoc[Mermaid C4 Samples].

== System Context (C4)
ifdef::env-github[[source,mermaid]]
ifndef::env-github[[mermaid, format={mermaid-format}]]
----
    C4Context
      title System Context diagram for Internet Banking System
      Enterprise_Boundary(b0, "BankBoundary0") {
        Person(customerA, "Banking Customer A", "A customer of the bank, with personal bank accounts.")
        Person(customerB, "Banking Customer B")
        Person_Ext(customerC, "Banking Customer C", "desc")

        Person(customerD, "Banking Customer D", "A customer of the bank, <br/> with personal bank accounts.")

        System(SystemAA, "Internet Banking System", "Allows customers to view information about their bank accounts, and make payments.")

        Enterprise_Boundary(b1, "BankBoundary") {

          SystemDb_Ext(SystemE, "Mainframe Banking System", "Stores all of the core banking information about customers, accounts, transactions, etc.")

          System_Boundary(b2, "BankBoundary2") {
            System(SystemA, "Banking System A")
            System(SystemB, "Banking System B", "A system of the bank, with personal bank accounts. next line.")
          }

          System_Ext(SystemC, "E-mail system", "The internal Microsoft Exchange e-mail system.")
          SystemDb(SystemD, "Banking System D Database", "A system of the bank, with personal bank accounts.")

          Boundary(b3, "BankBoundary3", "boundary") {
            SystemQueue(SystemF, "Banking System F Queue", "A system of the bank.")
            SystemQueue_Ext(SystemG, "Banking System G Queue", "A system of the bank, with personal bank accounts.")
          }
        }
      }

      BiRel(customerA, SystemAA, "Uses")
      BiRel(SystemAA, SystemE, "Uses")
      Rel(SystemAA, SystemC, "Sends e-mails", "SMTP")
      Rel(SystemC, customerA, "Sends e-mails to")

      UpdateElementStyle(customerA, $fontColor="red", $bgColor="grey", $borderColor="red")
      UpdateRelStyle(customerA, SystemAA, $textColor="blue", $lineColor="blue", $offsetX="5")
      UpdateRelStyle(SystemAA, SystemE, $textColor="blue", $lineColor="blue", $offsetY="-10")
      UpdateRelStyle(SystemAA, SystemC, $textColor="blue", $lineColor="blue", $offsetY="-40", $offsetX="-50")
      UpdateRelStyle(SystemC, customerA, $textColor="red", $lineColor="red", $offsetX="-50", $offsetY="20")

      UpdateLayoutConfig($c4ShapeInRow="5", $c4BoundaryInRow="3")
----
== System Context (C4)
ifdef::env-github[[source,mermaid]]
ifndef::env-github[[mermaid, format={mermaid-format}]]
----
C4Container
  title Container Diagram
  Person(user, "User", "Interacts with the system")
  System_Boundary(system, "Example System") {
    Container(web, "Web App", "SPA", "Delivers UI")
    Container(api, "API Service", "Spring Boot", "Business logic and APIs")
    ContainerDb(db, "Database", "PostgreSQL", "Stores data")
  }
  Rel(user, web, "Uses", "HTTPS")
  Rel(web, api, "Calls", "REST/JSON")
  Rel(api, db, "Reads/Writes", "JDBC")
----
ifdef::env-github[[source,mermaid]]
ifndef::env-github[[mermaid, format={mermaid-format}]]
....
C4Container
  title Container Diagram
  Person(user, "User", "Interacts with the system")
  System_Boundary(system, "Example System") {
    Container(web, "Web App", "SPA", "Delivers UI")
    Container(api, "API Service", "Spring Boot", "Business logic and APIs")
    ContainerDb(db, "Database", "PostgreSQL", "Stores data")
  }
  Rel(user, web, "Uses", "HTTPS")
  Rel(web, api, "Calls", "REST/JSON")
  Rel(api, db, "Reads/Writes", "JDBC")
....
== Login Flow (sequence)
ifdef::env-github[[source,mermaid]]
ifndef::env-github[[mermaid, format={mermaid-format}]]
----
sequenceDiagram
  actor User as User
  participant Web as Web App
  participant API as Auth API
  participant IdP as Identity Provider

  User->>Web: Open login page
  Web->>API: POST /auth/start
  API->>IdP: OIDC Authorization Request
  IdP-->>User: Login form
  User->>IdP: Credentials
  IdP-->>API: Authorization Code
  API->>IdP: Token request (code)
  IdP-->>API: ID/Access tokens (JWT)
  API-->>Web: Session established
  Web-->>User: Redirect to dashboard
----
